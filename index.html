<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To-Do List Realtime</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4C76y8m0u7QBDownZGnbhpiPs9AT9AkY",
      authDomain: "todo-realtime-318f7.firebaseapp.com",
      projectId: "todo-realtime-318f7",
      storageBucket: "todo-realtime-318f7.firebasestorage.app",
      messagingSenderId: "153651970645",
      appId: "1:153651970645:web:8f97601a96edb822ba0adc",
      measurementId: "G-VGLGC7G5MT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const todosCol = collection(db, "todos");

    // Referensi elemen
    const form = document.getElementById("todoForm");
    const list = document.getElementById("todoList");

    // Tambah data
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const title = form.title.value.trim();
      const date = form.date.value;
      const priority = form.priority.value;
      const time = form.time.value;
      const pic = form.pic.value.trim();

      if (!title) return alert("Isi dulu judul tugasnya!");

      await addDoc(todosCol, {
        title,
        date,
        priority,
        time,
        pic,
        done: false,
        createdAt: new Date()
      });

      form.reset();
    });

    // Tampilkan realtime data
    onSnapshot(todosCol, (snapshot) => {
      list.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const todo = docSnap.data();
        const li = document.createElement("div");
        li.className = "todo-item";
        li.innerHTML = `
          <div>
            <h3>${todo.title}</h3>
            <p>üìÖ ${todo.date || "Tanpa tanggal"} ${todo.time ? `‚Ä¢ Selesai jam ${todo.time}` : ""}</p>
            <p>‚≠ê ${todo.priority || "medium"}</p>
            <p>üë§ <b>PIC:</b> ${todo.pic || "Belum ditentukan"}</p>
          </div>
          <div class="actions">
            <button class="done ${todo.done ? "active" : ""}">‚úî</button>
            <button class="edit">‚úèÔ∏è</button>
            <button class="delete">üóëÔ∏è</button>
          </div>
        `;

        // Tombol selesai
        li.querySelector(".done").onclick = async () => {
          await updateDoc(doc(db, "todos", docSnap.id), { done: !todo.done });
        };

        // Tombol hapus
        li.querySelector(".delete").onclick = async () => {
          if (confirm("Hapus tugas ini?")) {
            await deleteDoc(doc(db, "todos", docSnap.id));
          }
        };

        // Tombol edit
        li.querySelector(".edit").onclick = async () => {
          const newTitle = prompt("Edit nama tugas:", todo.title);
          const newPic = prompt("Edit PIC:", todo.pic || "");
          if (newTitle !== null && newPic !== null) {
            await updateDoc(doc(db, "todos", docSnap.id), { title: newTitle, pic: newPic });
          }
        };

        if (todo.done) li.classList.add("done");
        list.appendChild(li);
      });
    });
  </script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0e1726;
      color: #f5f6fa;
      margin: 0;
      padding: 30px;
    }
    h1 { text-align: center; margin-bottom: 20px; }
    form {
      background: #1a2332;
      padding: 20px;
      border-radius: 12px;
      display: grid;
      gap: 10px;
      max-width: 500px;
      margin: 0 auto 20px;
    }
    input, select, button {
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      background: #00bcd4;
      color: #fff;
      cursor: pointer;
    }
    .todo-item {
      background: #1a2332;
      border-radius: 12px;
      padding: 15px 20px;
      margin: 10px auto;
      max-width: 500px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .todo-item.done { opacity: 0.5; text-decoration: line-through; }
    .actions button {
      margin-left: 6px;
      background: #00bcd4;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
    }
    .actions .done.active {
      background: #2ecc71;
    }
  </style>
</head>
<body>
  <h1>üìù To-Do List Realtime (with PIC)</h1>
  <form id="todoForm">
    <input type="text" name="title" placeholder="Judul tugas..." required />
    <input type="date" name="date" />
    <input type="time" name="time" />
    <select name="priority">
      <option value="low">low</option>
      <option value="medium" selected>medium</option>
      <option value="high">high</option>
    </select>
    <input type="text" name="pic" placeholder="Nama PIC (penanggung jawab)" />
    <button type="submit">Tambah Tugas</button>
  </form>

  <div id="todoList"></div>
</body>
</html>
