<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do Online Realtime</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #1e293b;
      --accent: #38bdf8;
      --accent2: #6ee7b7;
      --text: #e2e8f0;
      --muted: #94a3b8;
      font-family: 'Inter', sans-serif;
    }
    body {
      background: linear-gradient(180deg, #07101a 0%, #071a2a 100%);
      color: var(--text);
      margin: 0; padding: 32px;
      display: flex; justify-content: center;
    }
    .wrap {
      width: 100%; max-width: 980px;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 26px;
      color: var(--accent);
      margin: 0;
    }
    p { color: var(--muted); font-size: 14px; }

    .grid {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 16px;
    }
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    input, select, textarea {
      width: 100%;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    button {
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      color: #0f172a;
      font-weight: bold;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--muted);
    }
    .task {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .task.done h3 { text-decoration: line-through; opacity: 0.6; }
    .meta { font-size: 12px; color: var(--muted); margin-top: 4px; }
    .actions button { margin-left: 6px; font-size: 12px; }
    @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üìù To-Do List Realtime</h1>
      <p>Semua user berbagi data yang sama secara realtime ‚Äî tanpa login.</p>
    </header>

    <div class="grid">
      <section class="card">
        <form id="taskForm">
          <input id="title" type="text" placeholder="Judul tugas..." required>
          <textarea id="note" rows="2" placeholder="Catatan tambahan (opsional)"></textarea>
          <div style="display:flex; gap:8px;">
            <input id="due" type="date">
            <select id="priority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <input id="tags" type="text" placeholder="Tag (pisah koma)">
          <div style="display:flex; gap:8px;">
            <button type="submit">Tambah</button>
            <button id="updateBtn" type="button" class="btn-ghost" style="display:none;">Update</button>
            <button id="cancelEdit" type="button" class="btn-ghost" style="display:none;">Batal</button>
          </div>
        </form>

        <hr style="margin:12px 0; border:none; border-top:1px solid rgba(255,255,255,0.1);">

        <div style="display:flex; gap:8px; margin-bottom:10px;">
          <input id="search" placeholder="Cari tugas..." style="flex:1;">
          <select id="filter">
            <option value="all">Semua</option>
            <option value="active">Aktif</option>
            <option value="done">Selesai</option>
          </select>
        </div>

        <div id="taskList"></div>
      </section>

      <aside class="card">
        <h3>üìä Ringkasan</h3>
        <p>Total: <span id="countTotal">0</span></p>
        <p>Aktif: <span id="countActive">0</span></p>
        <p>Selesai: <span id="countDone">0</span></p>
        <hr style="margin:12px 0; border:none; border-top:1px solid rgba(255,255,255,0.1);">
        <small style="color:var(--muted)">üî• Data realtime menggunakan Firebase Firestore.<br>Versi 2.0 oleh ChatGPT x Rijal.</small>
      </aside>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, deleteDoc, updateDoc,
      onSnapshot, doc, query, orderBy, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    // ‚úÖ Konfigurasi Firebase kamu
    const firebaseConfig = {
      apiKey: "AIzaSyD4C76y8m0u7QBDownZGnbhpiPs9AT9AkY",
      authDomain: "todo-realtime-318f7.firebaseapp.com",
      projectId: "todo-realtime-318f7",
      storageBucket: "todo-realtime-318f7.firebasestorage.app",
      messagingSenderId: "153651970645",
      appId: "1:153651970645:web:8f97601a96edb822ba0adc",
      measurementId: "G-VGLGC7G5MT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const todosRef = collection(db, "todos");

    let editingId = null;

    const form = document.getElementById("taskForm");
    const listEl = document.getElementById("taskList");
    const searchEl = document.getElementById("search");
    const filterEl = document.getElementById("filter");

    // ‚ûï Tambah Tugas
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const title = titleEl.value.trim();
      if (!title) return alert("Judul wajib diisi!");
      const newTask = {
        title,
        note: noteEl.value.trim(),
        priority: priorityEl.value,
        due: dueEl.value,
        tags: tagsEl.value,
        done: false,
        createdAt: serverTimestamp()
      };
      await addDoc(todosRef, newTask);
      form.reset();
    });

    // üìù Edit / Update
    const titleEl = document.getElementById("title");
    const noteEl = document.getElementById("note");
    const priorityEl = document.getElementById("priority");
    const dueEl = document.getElementById("due");
    const tagsEl = document.getElementById("tags");
    const updateBtn = document.getElementById("updateBtn");
    const cancelEdit = document.getElementById("cancelEdit");

    updateBtn.onclick = async () => {
      if (!editingId) return;
      const ref = doc(db, "todos", editingId);
      await updateDoc(ref, {
        title: titleEl.value,
        note: noteEl.value,
        priority: priorityEl.value,
        due: dueEl.value,
        tags: tagsEl.value
      });
      editingId = null;
      form.reset();
      updateBtn.style.display = cancelEdit.style.display = "none";
    };
    cancelEdit.onclick = () => {
      editingId = null;
      form.reset();
      updateBtn.style.display = cancelEdit.style.display = "none";
    };

    // üîÅ Realtime listener
    const q = query(todosRef, orderBy("createdAt", "desc"));
    onSnapshot(q, (snap) => {
      let tasks = [];
      snap.forEach((docu) => tasks.push({ id: docu.id, ...docu.data() }));
      render(tasks);
    });

    // üß© Render UI
    function render(items) {
      const q = searchEl.value.toLowerCase();
      const f = filterEl.value;
      const filtered = items.filter(t => {
        if (f === "done" && !t.done) return false;
        if (f === "active" && t.done) return false;
        if (q && !t.title.toLowerCase().includes(q) && !(t.tags||"").toLowerCase().includes(q))
          return false;
        return true;
      });

      listEl.innerHTML = "";
      filtered.forEach(t => {
        const el = document.createElement("div");
        el.className = "task" + (t.done ? " done" : "");
        el.innerHTML = `
          <div>
            <h3>${t.title}</h3>
            <div class="meta">
              ${t.due ? "üìÖ " + t.due + " ‚Ä¢ " : ""}
              ${t.priority ? "‚≠ê " + t.priority + " ‚Ä¢ " : ""}
              ${t.tags ? "üè∑ " + t.tags + " ‚Ä¢ " : ""}
              ${t.note ? t.note : ""}
            </div>
          </div>
          <div class="actions">
            <button data-id="${t.id}" data-act="toggle">${t.done ? "‚ü≥" : "‚úî"}</button>
            <button data-id="${t.id}" data-act="edit">‚úèÔ∏è</button>
            <button data-id="${t.id}" data-act="delete">üóë</button>
          </div>
        `;
        listEl.appendChild(el);
      });

      document.getElementById("countTotal").textContent = items.length;
      document.getElementById("countActive").textContent = items.filter(x => !x.done).length;
      document.getElementById("countDone").textContent = items.filter(x => x.done).length;
    }

    // üéØ Aksi
    listEl.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const id = btn.dataset.id;
      const act = btn.dataset.act;
      const ref = doc(db, "todos", id);

      if (act === "delete") await deleteDoc(ref);
      else if (act === "toggle") await updateDoc(ref, { done: true });
      else if (act === "edit") {
        editingId = id;
        const el = btn.closest(".task");
        titleEl.value = el.querySelector("h3").textContent;
        updateBtn.style.display = cancelEdit.style.display = "inline-block";
      }
    });

    searchEl.oninput = () => render([]);
    filterEl.onchange = () => render([]);
  </script>
</body>
</html>
