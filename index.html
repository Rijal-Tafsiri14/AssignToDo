<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>To-Do Online â€” Tanpa Install</title>
  <meta name="description" content="Aplikasi todo sederhana: akses lewat browser, simpan di localStorage. Opsional: sinkronisasi Firebase.">
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
      --radius:12px; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; min-height:100vh; background:linear-gradient(180deg,#07101a 0%, #071a2a 100%); color:#e6eef6; display:flex; align-items:center; justify-content:center; padding:32px}
    .wrap{width:100%; max-width:980px}
    header{display:flex; align-items:center; gap:16px; margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:#042024}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted); font-size:13px}

    .grid{display:grid; grid-template-columns:1fr 360px; gap:18px}
    .card{background:var(--card); padding:18px; border-radius:var(--radius); box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    input[type=text], input[type=date], select, textarea{background:var(--glass); border:1px solid rgba(255,255,255,0.04); padding:10px 12px; color:inherit; border-radius:8px; width:100%; outline:none}
    button{background:linear-gradient(90deg,var(--accent),#60a5fa); color:#042024; border:none; padding:10px 12px; border-radius:10px; cursor:pointer}
    .btn-ghost{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted)}

    .controls{display:flex; gap:8px; align-items:center; margin-bottom:12px}
    .search{flex:1}

    .list{max-height:64vh; overflow:auto}
    .task{display:flex; gap:12px; align-items:flex-start; padding:10px; border-radius:10px; margin-bottom:8px; border:1px solid rgba(255,255,255,0.02); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .task .left{flex:1}
    .task h3{margin:0;font-size:15px}
    .meta{font-size:12px;color:var(--muted); margin-top:6px}
    .completed h3{text-decoration:line-through; opacity:0.6}

    footer{margin-top:12px; color:var(--muted); font-size:13px}

    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .logo{width:48px;height:48px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">TD</div>
      <div>
        <h1>To-Do Online</h1>
        <p class="lead">Aplikasi todo yang bisa dibuka lewat browser â€” tidak perlu install. Data tersimpan di browser atau disinkronkan ke Firebase.</p>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <form id="taskForm">
          <div style="display:flex; gap:8px; margin-bottom:8px">
            <input id="title" type="text" placeholder="Tulis tugas..." required>
            <select id="priority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div style="display:flex; gap:8px; margin-bottom:8px">
            <input id="due" type="date">
            <input id="tags" type="text" placeholder="Tag (pisah koma)">
          </div>
          <textarea id="note" rows="2" placeholder="Catatan (opsional)" style="margin-bottom:8px"></textarea>
          <div style="display:flex; gap:8px">
            <button id="saveBtn" type="submit">Tambah</button>
            <button id="updateBtn" type="button" class="btn-ghost" style="display:none">Update</button>
            <button id="cancelEdit" type="button" class="btn-ghost" style="display:none">Batal</button>
          </div>
        </form>

        <hr style="border:none; height:1px; background:rgba(255,255,255,0.05); margin:12px 0">

        <div class="controls">
          <input id="search" class="search" placeholder="Cari tugas...">
          <select id="filter">
            <option value="all">Semua</option>
            <option value="active">Aktif</option>
            <option value="completed">Selesai</option>
          </select>
          <select id="sort">
            <option value="new">Terbaru</option>
            <option value="old">Terlama</option>
            <option value="due">Jatuh Tempo</option>
            <option value="priority">Prioritas</option>
          </select>
        </div>

        <div class="list" id="taskList"></div>

        <footer>Untuk sinkronisasi antar perangkat, aktifkan Firebase Firestore di bawah.</footer>
      </section>

      <aside class="card">
        <h3 style="margin-top:0">Ringkasan</h3>
        <div style="margin:10px 0; color:var(--muted)">
          <div>Total: <span id="countTotal">0</span></div>
          <div>Aktif: <span id="countActive">0</span></div>
          <div>Selesai: <span id="countDone">0</span></div>
        </div>

        <hr style="border:none; height:1px; background:rgba(255,255,255,0.05); margin:12px 0">
        <h4>Sinkronisasi Firebase</h4>
        <button id="syncOn" class="btn-ghost">Aktifkan Firebase</button>
        <small style="color:var(--muted); display:block; margin-top:10px">Versi 1.1 â€¢ ChatGPT</small>
      </aside>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    // KONFIGURASI FIREBASE (ubah sesuai project kamu)
    const firebaseConfig = {
      apiKey: "AIzaSyCdVNx-P4OoemNhx2lTG0LtZIkIAjxQUD0",
      authDomain: "todolist-fdf92.firebaseapp.com",
      projectId: "todolist-fdf92",
      storageBucket: "todolist-fdf92.firebasestorage.app",
      messagingSenderId: "865792443871",
      appId: "1:865792443871:web:c17c9935190fa68623306a",
      measurementId: "G-ZNQ76GQKKC"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ===== LOCAL STORAGE FALLBACK =====
    const STORAGE_KEY = 'todo_app_v2';
    let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    function saveLocal() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      render();
    }

    // ===== CRUD LOGIC =====
    function addTask(data) {
      tasks.push({
        id: 't' + Date.now(),
        title: data.title,
        note: data.note || '',
        tags: data.tags || '',
        priority: data.priority || 'medium',
        due: data.due || '',
        done: false,
        created: Date.now()
      });
      saveLocal();
    }

    function toggleDone(id) {
      const t = tasks.find(x => x.id === id);
      if (t) t.done = !t.done;
      saveLocal();
    }

    function removeTask(id) {
      tasks = tasks.filter(x => x.id !== id);
      saveLocal();
    }

    function render() {
      const list = document.getElementById('taskList');
      list.innerHTML = '';
      for (const t of tasks) {
        const el = document.createElement('div');
        el.className = 'task' + (t.done ? ' completed' : '');
        el.innerHTML = `
          <div class="left">
            <h3>${t.title}</h3>
            <div class="meta">${t.due ? 'ðŸ“… ' + t.due + ' â€¢ ' : ''}${t.priority}</div>
          </div>
          <div class="actions">
            <button class="btn-ghost" onclick="toggleDone('${t.id}')">${t.done ? 'Buka' : 'Selesai'}</button>
            <button class="btn-ghost" onclick="removeTask('${t.id}')">Hapus</button>
          </div>`;
        list.appendChild(el);
      }
      document.getElementById('countTotal').textContent = tasks.length;
      document.getElementById('countDone').textContent = tasks.filter(t => t.done).length;
      document.getElementById('countActive').textContent = tasks.filter(t => !t.done).length;
    }

    render();

    // ===== EVENT LISTENER =====
    document.getElementById('taskForm').addEventListener('submit', e => {
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      if (!title) return alert('Tulis tugas terlebih dahulu!');
      addTask({
        title,
        note: document.getElementById('note').value.trim(),
        tags: document.getElementById('tags').value.trim(),
        priority: document.getElementById('priority').value,
        due: document.getElementById('due').value
      });
      e.target.reset();
    });

    document.getElementById('syncOn').addEventListener('click', async () => {
      if (!confirm('Aktifkan sinkronisasi Firebase?')) return;
      // Simpan semua task ke Firestore
      for (const t of tasks) {
        await addDoc(collection(db, "todos"), t);
      }
      alert('âœ… Sinkronisasi ke Firebase berhasil!');
    });

    // Expose functions for inline onclick
    window.toggleDone = toggleDone;
    window.removeTask = removeTask;
  </script>
</body>
</html>
